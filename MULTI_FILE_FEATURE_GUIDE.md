# 多文件数据组合功能使用指南

## 新功能概述

本次更新添加了两个重要的新功能：

### 1. 多文件数据组合功能
- **功能描述**: 允许用户选择多个Excel文件，从每个文件中选择特定的数据段，按顺序组合成一个连续的图表
- **使用场景**: 例如温度加热过程的不同阶段数据来自不同文件，需要组合显示完整的温度曲线

### 2. 纵坐标标签多选功能
- **功能描述**: 提供预设的纵坐标标签选项，包括自定义选项
- **可选项**: Water Concentration (ppm)、Temperature (°C)、Moisture Concentration (ppm)、Pressure (bar)、自定义

## 使用方法

### 多文件数据组合

1. **启动应用程序**
   ```bash
   python3 main.py
   ```

2. **选择多文件模式**
   - 在主界面的"文件选择"区域
   - 点击"选择多个Excel文件组合"按钮

3. **配置多文件组合**
   - **选择文件**: 点击"选择多个Excel文件"按钮，一次性选择多个Excel文件
   - **查看文件信息**: 在"文件信息"表格中可以看到每个文件的列数和可用列
   - **配置数据段**: 
     - 点击"添加数据段"按钮
     - 为每个数据段配置：
       - 选择文件（从下拉列表中选择）
       - 选择要组合的列名（会自动识别温度相关列）
       - 选择时间列（会自动识别时间相关列）
       - 设置开始时间和结束时间（小时）
       - 使用"全选时间"按钮一键设置为文件的完整时间范围
     - 可以添加多个数据段，按顺序组合
     - 支持删除不需要的数据段（带确认提示）

4. **预览和确认**
   - 点击"预览组合结果"查看组合统计信息
   - 确认无误后点击"确定"

5. **生成图表**
   - 返回主界面后，点击"Generate Chart"生成组合数据图表

### 纵坐标标签设置

1. **选择预设标签**
   - 在"图表设置"区域的"纵坐标标签"下拉框中
   - 选择合适的预设选项：
     - Water Concentration (ppm) - 默认选项
     - Temperature (°C) - 温度
     - Moisture Concentration (ppm) - 湿度浓度
     - Pressure (bar) - 压力

2. **自定义标签**
   - 选择"自定义"选项
   - 在出现的输入框中输入自定义的纵坐标标签

## 示例：温度加热过程组合

假设您有4个Excel文件，包含不同加热阶段的温度数据：

1. **文件1**: `20-90C.xlsx` - 包含20-90°C阶段的数据
2. **文件2**: `90-290C.xlsx` - 包含90-290°C阶段的数据  
3. **文件3**: `290-500C.xlsx` - 包含290-500°C阶段的数据
4. **文件4**: `500-550C.xlsx` - 包含500-550°C阶段的数据

### 配置步骤：

1. 选择"选择多个Excel文件组合"
2. 选择所有4个文件
3. 按顺序添加数据段：
   - **数据段1**: 文件1，温度列，时间范围0-2小时
   - **数据段2**: 文件2，温度列，时间范围0-2小时  
   - **数据段3**: 文件3，温度列，时间范围0-2小时
   - **数据段4**: 文件4，温度列，时间范围0-2小时
4. 设置纵坐标标签为"Temperature (°C)"
5. 生成连续的温度曲线图

## 新功能亮点

### 智能列识别
- **自动温度列识别**: 包含"temperatur"、"temp"、"温度"、"°C"等关键词的列会被自动选择
- **自动时间列识别**: 包含"zeit"、"time"、"timestamp"、"datetime"、"时间"等关键词的列会被自动选择

### 一键时间设置
- **全选时间功能**: 点击"全选时间"按钮自动设置为该文件的完整时间范围
- **智能时间计算**: 自动分析文件的实际时间跨度，无需手动计算

### 用户体验改进
- **信号连接修复**: 修复了列选择下拉框无法正常工作的问题
- **删除确认**: 删除数据段前会弹出确认对话框，避免误操作
- **动态更新**: 文件选择变化时，列选择会动态更新

## 注意事项

1. **文件格式**: 确保所有Excel文件格式正确，包含有效的数值数据
2. **时间列**: 每个文件需要包含时间列，用于数据的时间对齐
3. **数据连续性**: 程序会自动调整时间偏移，确保组合后的数据在时间轴上连续显示
4. **内存使用**: 处理大量文件时注意内存使用情况
5. **数据备份**: 建议在处理重要数据前进行备份

## 故障排除

### 常见问题

1. **"没有有效的数据可以组合"**
   - 检查选择的列是否包含有效的数值数据
   - 确认时间范围设置是否正确
   - 验证时间列是否包含有效的时间数据

2. **图表显示异常**
   - 检查数据单位是否一致
   - 确认纵坐标标签设置是否合适
   - 验证数据范围是否合理

3. **文件加载失败**
   - 确认Excel文件没有被其他程序占用
   - 检查文件是否损坏
   - 验证文件路径是否正确

### 获取帮助

如果遇到问题，请：
1. 检查控制台输出的错误信息
2. 确认数据文件格式
3. 尝试使用单文件模式验证数据
4. 检查依赖库是否正确安装

## 技术细节

### 新增模块
- `data_processing/multi_file_loader.py` - 多文件数据加载和组合
- `ui/multi_file_dialog.py` - 多文件配置对话框

### 修改的模块
- `ui/main_window.py` - 添加多文件支持和纵坐标多选
- `ui/plot_widget.py` - 支持多文件数据绘图

### 数据结构
组合后的数据包含以下列：
- `relative_time` - 相对时间（小时）
- `combined_value` - 组合的数值数据
- `source` - 数据来源标识（文件名_列名）

## 更新日志

### 版本 1.1 (最新)
**问题修复:**
- ✅ 修复列选择下拉框无法正常工作的问题
- ✅ 修复信号连接在动态表格中的绑定问题
- ✅ 修复删除行后信号丢失的问题

**新增功能:**
- ✅ 添加"全选时间"按钮，一键设置完整时间范围
- ✅ 智能列识别，自动选择温度和时间相关列
- ✅ 删除数据段时添加确认对话框
- ✅ 改进表格布局，增加时间操作列

**用户体验改进:**
- ✅ 优化界面布局，提高操作便利性
- ✅ 添加详细的操作提示和错误信息
- ✅ 改进数据段配置的默认值设置

### 版本 1.0
**初始功能:**
- ✅ 多文件数据组合功能
- ✅ 纵坐标标签多选功能
- ✅ 基础的数据段配置界面 