# H2O Data Visualization and Calibration Tool

一个用于水分浓度数据可视化和校准的专业工具，支持Excel数据导入、实时图表生成、湿度传感器校准以及差值分析等功能。

## 📐 界面设计

### 🎨 现代化两栏布局
- **左栏**：数据输入和基本设置
  - 文件选择区域
  - 列选择功能
  - 时间设置选项
  
- **右栏**：高级功能和校准
  - 湿度校准参数
  - 校准配对设置
  - 差值分析功能

- **底部**：主要操作按钮
  - 图表生成
  - 数据导出

### 🖋️ 统一设计语言
- **字体统一**：全界面使用Arial字体，主要文字16pt（相当于三号字）
- **字体层次**：标题16pt、控件14pt、小按钮12pt、主按钮18pt
- **间距合理**：10px标准间距，确保视觉舒适
- **按钮一致**：控件35px高度，主操作按钮50px
- **分组清晰**：使用GroupBox进行功能分组

## 功能特点

### 📊 数据可视化
- 支持Excel文件(.xlsx, .xls)导入
- 多列数据同时绘制
- 时间序列数据处理
- 独立窗口图表显示
- 图表保存和复制功能

### 🔧 湿度传感器校准
- 基于压力校准的湿度数据修正
- 支持多组湿度-压力对配置（最多6组）
- 自动匹配列名功能
- 校准参数导入/导出
- 误差范围显示

### 📈 差值分析
- 30分钟时间点差值计算
- 多时间点差值分析(20/40/60分钟)
- 参考列设置和比较
- 结果导出功能

### ⚙️ 其他功能
- 时间范围选择(全部/前2小时/自定义)
- 最近配置自动保存
- 批量数据导出
- 中文界面支持

## 安装和运行

### 方法一：使用启动脚本（推荐）
```bash
# 克隆或下载项目
cd masterthesis-data

# 运行启动脚本（会自动安装依赖）
./start.sh
```

### 方法二：手动安装
```bash
# 安装Python依赖
pip3 install PyQt5 matplotlib pandas numpy openpyxl

# 运行程序
python3 main.py
```

### 方法三：使用run.py
```bash
python3 run.py
```

## 使用方法

### 1. 加载数据文件
1. 点击"Select Excel File"按钮
2. 选择包含水分浓度和时间数据的Excel文件
3. 程序会自动识别列名并填充到选择列表中

### 2. 选择数据列
1. 在**左栏**的列选择区域中，使用Ctrl+点击选择多个要绘制的数据列
2. 在时间设置区域选择时间列
3. 可以点击"Auto-Match Pairs"按钮自动匹配湿度-压力对

### 3. 配置校准参数（可选）
1. 在**右栏**的校准设置区域中：
   - 勾选"Enable Moisture Calibration"启用校准
   - 设置校准参数 f1, f2, p_ref
   - 配置湿度-压力对（最多6组）
   - 设置误差范围

### 4. 设置时间范围
1. 选择显示模式：
   - "Show All Data"：显示全部数据
   - "First 2 Hours Only"：只显示前2小时
   - "Custom Range"：自定义时间范围

### 5. 差值分析（可选）
1. 在差值计算区域：
   - 勾选相应的差值计算选项
   - 设置参考列
   - 配置时间窗口

### 6. 生成图表和导出
1. 点击**底部**的"Generate Chart"按钮生成图表
2. 点击"Export Data"按钮导出处理后的数据

## 界面布局特点

### 🔍 左栏功能
- **数据输入**：专注于数据加载和基本选择
- **时间控制**：时间列选择和范围设置
- **直观操作**：清晰的按钮和列表界面

### ⚙️ 右栏功能  
- **高级设置**：校准参数和配对管理
- **专业工具**：差值分析和误差计算
- **参数管理**：导入导出功能

### 🎯 操作流程
1. **左栏** → 加载数据，选择列，设置时间
2. **右栏** → 配置校准，设置差值分析
3. **底部** → 生成图表，导出结果

## 技术特点

### 🏗️ 架构设计
- **模块化结构**：清晰的代码分层
- **PyQt5界面**：现代化GUI框架
- **数据处理**：pandas + numpy数据分析
- **图表绘制**：matplotlib专业绘图

### 📏 界面规范
- **响应式布局**：自适应窗口大小
- **字体规范**：
  - 主要标签：Arial 16pt（三号字大小）
  - 控件文字：Arial 14pt（小三号字大小）
  - 小按钮：Arial 12pt
  - 主按钮：Arial 18pt Bold（二号字大小）
- **一致间距**：10px标准间距
- **分组管理**：GroupBox功能分组

### 🔧 校准算法
- 使用压力修正公式：`ppm_calibrated = concentration × (p_ref/p)^(f1·ln(p_ref/p)+f2)`
- 默认参数：f1=0.196798, f2=0.419073, p_ref=1.0
- 支持误差范围显示

## 系统要求

- **Python**: 3.7+
- **操作系统**: Windows / macOS / Linux  
- **依赖包**: PyQt5, matplotlib, pandas, numpy, openpyxl
- **内存**: 建议4GB+
- **屏幕**: 1200x800分辨率及以上

## 文件结构

```
masterthesis-data/
├── main.py                    # 主程序入口
├── run.py                     # 简化启动
├── start.sh                   # 自动安装脚本
├── README.md                  # 详细说明文档
├── QUICK_START.md             # 快速开始指南
├── requirements.txt           # 依赖列表
├── ui/                        # 用户界面模块
│   ├── main_window.py        # 主窗口（两栏布局）
│   └── plot_widget.py        # 绘图组件
├── data_processing/           # 数据处理模块
│   ├── data_loader.py        # 数据加载器
│   └── time_analysis.py      # 时间分析
├── calibration/               # 校准功能模块
│   ├── calibration_core.py   # 校准核心算法
│   └── parameter_manager.py  # 参数管理
├── utils/                     # 工具模块
│   └── file_utils.py         # 文件工具
└── external_samples/          # 示例和测试文件
```

## 更新历史

### v2.0 - 两栏布局设计
- 🎨 **界面重构**：采用现代化两栏布局
- 🖋️ **字体统一**：全界面Arial 10pt标准字体
- 📐 **间距优化**：10px标准间距，视觉更舒适
- 🔧 **功能分组**：左栏数据输入，右栏高级功能
- 📱 **响应式设计**：自适应窗口大小变化

### v1.0 - 基础功能版本
- 📊 数据可视化和图表生成
- 🔧 湿度传感器校准功能
- 📈 差值分析和导出功能
- 💾 参数保存和加载功能

## 支持和反馈

如遇到问题或有改进建议，请创建Issue或提交Pull Request。

---

**开发团队**: H2O数据分析小组  
**最后更新**: 2024年